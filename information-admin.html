<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>お知らせ管理</title>

  <style>
    :root {
      --accent:#0b6fb2;
      --muted:#6b7280;
      --card:#ffffff;
      font-family: Inter, Noto Sans JP, system-ui;
    }

    body{
      background:#f4f7fb;
      margin:0;
      padding:20px;
    }

    .container{
      max-width:900px;
      margin:0 auto;
    }

    h1{
      text-align:center;
      margin-bottom:20px;
    }

    .card{
      background:white;
      padding:20px;
      border-radius:12px;
      margin-bottom:20px;
      box-shadow:0 4px 16px rgba(0,0,0,0.08);
    }

    label{font-weight:600;display:block;margin-top:10px;}

    input, textarea, select{
      width:100%;
      padding:10px;
      border:1px solid #ccc;
      border-radius:8px;
      margin-top:6px;
    }

    textarea{height:120px;}

    .img-preview{
      width:100%;
      margin-top:10px;
      border-radius:8px;
    }

    .btn{
      background:var(--accent);
      color:white;
      border:none;
      padding:12px 18px;
      border-radius:8px;
      cursor:pointer;
      font-size:15px;
      margin-top:12px;
    }

    .btn:hover{background:#0a5f9f}

    .info-list{
      list-style:none;
      padding:0;
      margin:0;
    }

    .info-item{
      background:white;
      padding:14px 18px;
      margin-bottom:10px;
      border-radius:10px;
      box-shadow:0 2px 8px rgba(0,0,0,0.06);
      display:flex;
      justify-content:space-between;
      align-items:center;
    }

    .info-actions button{
      margin-left:8px;
      padding:6px 10px;
      border:none;
      border-radius:6px;
      cursor:pointer;
    }

    .edit-btn{background:#10b981;color:white;}
    .delete-btn{background:#ef4444;color:white;}

  </style>
</head>

<body>

<div class="container">

  <h1>お知らせ管理</h1>

  <!-- 管理者チェック -->
  <script>
    if(localStorage.getItem("admin-auth") !== "true"){
      location.href = "admin-login.html";
    }
  </script>

  <!-- 登録フォーム -->
  <div class="card">
    <h2>新規お知らせ登録</h2>

    <label>タイトル</label>
    <input id="title">

    <label>内容</label>
    <textarea id="content"></textarea>

    <label>カテゴリー</label>
    <select id="category">
      <option value="お知らせ">お知らせ</option>
      <option value="イベント">イベント</option>
      <option value="その他">その他</option>
    </select>

    <label>日付</label>
    <input id="date" type="date">

    <label>画像（最大3枚）</label>
    <input type="file" id="img1">
    <input type="file" id="img2">
    <input type="file" id="img3">

    <button class="btn" onclick="addInfo()">登録する</button>

  </div>

  <!-- 一覧 -->
  <div class="card">
    <h2>登録済みのお知らせ</h2>
    <ul class="info-list" id="infoList"></ul>
  </div>

</div>




<script>
document.getElementById("date").valueAsDate = new Date();

/* ===== Base64 読み込み ===== */
function fileToBase64(file){
  return new Promise(resolve=>{
    if(!file){resolve(null);return;}
    const reader = new FileReader();
    reader.onload = () => resolve(reader.result);
    reader.readAsDataURL(file);
  });
}

/* ===== 新規追加 ===== */
async function addInfo(){

  const title = document.getElementById("title").value;
  const content = document.getElementById("content").value;
  const category = document.getElementById("category").value;
  const date = document.getElementById("date").value;

  const img1 = await fileToBase64(document.getElementById("img1").files[0]);
  const img2 = await fileToBase64(document.getElementById("img2").files[0]);
  const img3 = await fileToBase64(document.getElementById("img3").files[0]);

  if(!title){
    alert("タイトルは必須です");
    return;
  }

  const raw = localStorage.getItem("information-list");
  const list = raw ? JSON.parse(raw) : [];

  const newInfo = {
    id: Date.now().toString(),     // 一意のID
    title,
    content,
    category,
    date,
    images: [img1, img2, img3].filter(v => v !== null),
    timestamp: Date.now()          // ⭐ 並び順を完全保証
  };

  list.push(newInfo);
  localStorage.setItem("information-list", JSON.stringify(list));

  alert("登録しました");
  loadList();
}



/* ===== 一覧読み込み ===== */
function loadList(){
  const raw = localStorage.getItem("information-list");
  const list = raw ? JSON.parse(raw) : [];

  /* 最新順（管理画面でも） */
  list.sort((a,b)=>b.timestamp - a.timestamp);

  const el = document.getElementById("infoList");
  if(list.length === 0){
    el.innerHTML = "<li>まだお知らせがありません</li>";
    return;
  }

  el.innerHTML = list.map(info => `
    <li class="info-item">
      <div>
        <div><strong>${info.title}</strong></div>
        <div style="color:gray;font-size:13px">${info.date}</div>
      </div>

      <div class="info-actions">
        <button class="edit-btn" onclick="editInfo('${info.id}')">編集</button>
        <button class="delete-btn" onclick="deleteInfo('${info.id}')">削除</button>
      </div>
    </li>
  `).join("");
}



/* ===== 編集 ===== */
function editInfo(id){
  location.href = "information_detail.html?id=" + id + "&edit=1";
}


/* ===== 削除 ===== */
function deleteInfo(id){
  if(!confirm("削除してもよろしいですか？")) return;

  const raw = localStorage.getItem("information-list");
  let list = raw ? JSON.parse(raw) : [];

  list = list.filter(i => i.id !== id);

  localStorage.setItem("information-list", JSON.stringify(list));
  loadList();
}

loadList();

</script>

</body>
</html>
